name: Daily Kicker Data Update

on:
  schedule:
    # Runs daily at 08:00 AM UTC (Ideal for refreshing morning data like weather/Vegas)
    - cron: '0 8 * * *'
  workflow_dispatch: # Allows manual trigger from the GitHub web interface

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Checkout Repository
        uses: actions/checkout@v3

      - name: 2. Set up Python Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.10' # Stable version for data science libraries

      - name: 3. Install Dependencies
        run: pip install -r requirements.txt

      - name: 4. Create Public Data Directory (Ensures path exists for Python)
        run: mkdir -p public

      - name: 5. Run Analysis Script (Writes directly to public/kicker_data.json)
        run: python calculate_stall_rate.py
        
      - name: 6. Configure Git for Commit
        run: |
          git config --global user.name "KickerGenius Bot"
          git config --global user.email "bot@kickergenius.com"

      - name: 7. Commit and Push Changes
        # This step commits the new JSON file and pushes it back to the repo
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Data Bot Update: Week ${{ github.event.inputs.week }} Kicker Projections"
          files: public/kicker_data.json
          commit_user_name: KickerGenius Bot
          commit_user_email: bot@kickergenius.com
          branch: main