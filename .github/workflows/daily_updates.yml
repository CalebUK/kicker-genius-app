name: Daily Kicker Data Update

on:
  schedule:
    # Runs daily at 08:00 AM UTC (Ideal for refreshing morning data like weather/Vegas)
    - cron: '0 8 * * *'
  workflow_dispatch: # Allows manual trigger from the GitHub web interface

jobs:
  update-data:
    runs-on: ubuntu-latest
    timeout-minutes: 10 # Set a generous timeout for the entire job
    permissions:
      contents: write # 1. IMPORTANT: Grant permission for the entire job

    steps:
      - name: 1. Checkout Repository (With Write Permissions)
        # 2. FIX: Explicitly set write permissions during checkout
        uses: actions/checkout@v4 
        with:
          token: ${{ secrets.GITHUB_TOKEN }} # Use the token provided by GitHub Actions for committing

      - name: 2. Set up Python Environment (3.10)
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Install Dependencies
        run: pip install -r requirements.txt

      - name: 4. Create Public Data Directory (Ensure lowercase)
        run: mkdir -p public

      - name: 5. Run Analysis Script (Writes directly to public/kicker_data.json)
        run: python calculate_stall_rate.py
        
      - name: 6. Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Data Bot Update: Week ${{ github.event.inputs.week }} Kicker Projections"
          file_pattern: 'public/kicker_data.json'
          commit_user_name: KickerGenius Bot
          commit_user_email: bot@kickergenius.com
          branch: main